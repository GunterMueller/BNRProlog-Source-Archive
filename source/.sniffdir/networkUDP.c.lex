
BNRP_opensocketUDP"3745 N {EAilport_number33;ninreceiveSocket54=62CN;nijso_optval70=79CM;niglength87=8>CG(96EIilsockaddr_in9>);EIilsockaddr_in=5ilreceiveAddr>1;DB(?2idtcb?3p?6ihnumargs?8icNEA@@CM)AL(A@LifFALSEA@M);DB(AAI!AAJisBNRPnetworkUseableAAK){ihFD_ZEROACD(ACK&ACLihBNRPfdsACM);ihFD_ZEROADI(AE@&AEAiqBNRPconnectedFdsAEB);}AFFAM(AGAiicheckArgAGB(AGJidtcbAGKpAGNieargsAH@[AHDCM],AHG&AHHilport_numberAHI)){ACieINTTAJC:DB(BCL(BCMilport_numberBCNicLTBDJioBNRPlowestPortBDM)BKBEM(BF@ilport_numberBFAicGTBFMijUSHRT_MAXBG@))AL(BHAifFALSEBHB);DB(BID(BIEinreceiveSocketBIF=BJDigsocketBJF(BJLihPF_INETBJM,BKDikSOCK_DGRAMBKE,BKOCN))icEQBLD-BLGCM){igperrorC@H(C@Ns);AL(CEBifFALSECEC);}CFCDB(CHEiksetsockoptCHF(CI@inreceiveSocketCIA,CINikSOL_SOCKETCJ@,CJJimSO_REUSEADDRCJL,CKH(CKJihoptValTCKK*CLC)&CLEijso_optvalCLF,CLOCG(CMGijso_optvalCMH))icNECNDCN){igperrorCOO(D@Es);ifcloseDBC(DBHinreceiveSocketDBI);AL(DDAifFALSEDDB);}DDKilreceiveAddrDEF.iksin_familyDFB=DFMihAF_INETDFO;ilreceiveAddrDH@.iisin_addrDHL.igs_addrDIE=DILifhtonlDIN(DJCikINADDR_ANYDJD);ilreceiveAddrDKI.iisin_portDLE=DLNifhtonsDM@(DMEilport_numberDMF);DB(EAFiebindEAG(EAKinreceiveSocketEAL,EBI(EBJEIiisockaddrECB*ECK)&ECMilreceiveAddrECN,EDICG(EE@ilreceiveAddrEEA))icEQEEO-EFBCM){igperrorEJ@(EJFs);ifcloseENB(ENGinreceiveSocketENH);AL(F@JifFALSEF@K);}FAKAB;ACieVARTFCN:DB(FDN(FDOinreceiveSocketFE@=FENigsocketFF@(FFFihPF_INETFFG,FFNikSOCK_DGRAMFFO,FGICN))icEQFGN-FHACM){igperrorFJK(FKAs);AL(FOEifFALSEFOF);}G@FilreceiveAddrGAA.iksin_familyGAM=GBHihAF_INETGBJ;ilreceiveAddrGCK.iisin_addrGDG.igs_addrGE@=GEGifhtonlGEI(GENikINADDR_ANYGEO);ilreceiveAddrGFM.iisin_portGGI=GHBifhtonsGHD(GHICN);DB(GKAiebindGKB(GKFinreceiveSocketGKG,GLD(GLEEIiisockaddrGLM*GMF)&GMHilreceiveAddrGMI,GNDCG(GNKilreceiveAddrGNL))icEQGOJ-GOMCM){igperrorHJB(HJHs);ifcloseHMM(HNBinreceiveSocketHNC);AL(HONifFALSEHOO);}I@HDB(IAFilgetsocknameIAG(IBBinreceiveSocketIBC,IC@(ICBEIiisockaddrICJ*IDC)&IDEilreceiveAddrIDF,IEA(IECiloptValSizeTIED*IF@)&IFBiglengthIFC)icNEIFKCN){igperrorII@(IIFs);ifcloseIMB(IMGinreceiveSocketIMH);AL(IOCifFALSEIOD);}IOMAB;AE:AL(JBJifFALSEJBK);}JCDisBNRPnetworkUseableJCH=JDKieTRUEJDM;ilBNRPfdCountJEDCEJF@;igFD_SETJFF(JFLinreceiveSocketJFM,JGJ&JGKihBNRPfdsJGL);{igprintfJIM(JJCs,JLFinreceiveSocketJLG);igprintfJMH(JMNs,K@E(K@FEA)ifntohsK@L(KAAilreceiveAddrKAB.iisin_portKAN));}KBMAL(KCNifunifyKCO(KDDidtcbKDE,KDHidtcbKDIpKDLieargsKDN[KEBCM],KEEihmakeintKEF(KEM&KENidtcbKEOpKFBichpKFD,KFF(KFGEA)ifntohsKFM(KGBilreceiveAddrKGC.iisin_portKGO)))BLKIFifunifyKII(KINidtcbKIO,KJBidtcbKJCpKJFieargsKJH[KJLCM],KJOihmakeintKK@(KKG&KKHidtcbKKIpKKLichpKKN,KL@inreceiveSocketKLA)));}KMC
BNRP_receivemessageUDP"6789 N {c*2<igmsgbuf2==34CN;c*42ilsmallbuffer43=4?CN;EAijrcvbufsiz5>;nigoptlen73=7:CG(82ijrcvbufsiz83);nigmsglen99;EAigsocket:8;EAigfilefd;:;nifbytes<<;nigretval===>7ieTRUE>9;nijerrorcode?9=A@CCN;nihcurrentAA@,AAGimcurrentStartAAI;ieFILEABK*AC@iffilepACA;EAigresultADA;EIilsockaddr_inAEFijrecv_addrAFB;ninrecv_addr_lenAHA=AHOCG(AIGijrecv_addrAIH);DB(AJIidtcbAJJpAJMihnumargsAJOicNEAKGCM)AL(ALCifFALSEALD);DB(ALO!AM@isBNRPnetworkUseableAMA)AL(ANKifFALSEANL);DB(AOGiicheckArgAOH(B@@idtcbB@ApB@DieargsB@F[B@JCM],B@M&B@NigsocketB@O)icNEBAGieINTTBAJ)AL(BBFifFALSEBBG);DB(BCB!BCCiiFD_ISSETBCD(BCLigsocketBCM,BDC&BDDihBNRPfdsBDE))AL(BEGifunifyBEH(BEMidtcbBEN,BFAidtcbBFBpBFEieargsBFG[BFKCM],BFNihmakeintBFO(BGF&BGGidtcbBGHpBGKichpBGM,BGOiiENOTSOCKBH@)));DB(BIAigsocketBIBicLTBIICM)AL(BJEifFALSEBJF);DB(BNEikgetsockoptBNF(BO@igsocketBOA,BOGikSOL_SOCKETBOI,C@CijSO_RCVBUFC@E,C@N(CA@ihoptValTCAA*CAI)&CAKijrcvbufsizCAL,CBE(CBGiloptValSizeTCBH*CCD)&CCFigoptlenCCG))ijrcvbufsizCDH=CEBimMAX_MSG_SIZECED;DB(CFJijrcvbufsizCFKicLECGECN)ijrcvbufsizCKI=CLCimMAX_MSG_SIZECLE;igprintfCNE(CNKs);DB(DBMimselectSocketDBN(DCJigsocketDCK,DDAioBNRPread_timerDDB)){igprintfDFH(DFNs);igmsgbufDNL=DOC(DOEc*DOK)ilBNRP_mallocDOM(E@HijrcvbufsizE@I+EABCM);ilsmallbufferEDA=EDM(EDOc*EEE)ilBNRP_mallocEEG(EFBijrcvbufsizEFC+EFLCM);DB(EINigmsgbufEIOicEQEJFCNBKEJKilsmallbufferEJNicEQEKJCN)ALifunifyF@O(FADidtcbFAE,FAHidtcbFAIpFALieargsFAN[FBBCM],FBEihmakeintFBF(FBM&FBNidtcbFBOpFCBichpFCD,FCFigENOMEMFCH));AG{iferrnoFEL=FFBCN;igmsglenFGC=FGJiirecvfromFGL(FHDigsocketFHE,FHKigmsgbufFHM,FICijrcvbufsizFIE,FINCN,FJA(FLAEIiisockaddrFLI*FMB)&FMDijrecv_addrFME,FMN(FMOiloptValSizeTFN@*FNL)&FNNinrecv_addr_lenFNO);}G@GAP(G@O(GA@igmsglenGAAicEQGAH-GAKCM)BLGAO(GBBiferrnoGBCicEQGBIifEINTRGBL));igprintfGDN(GEDs,GGKigmsglenGGM);DB(GIHigmsglenGIIicEQGJ@-GJCCM)ijerrorcodeGKC=GKMiferrnoGKO;DCigmsgbufGMO[GNEigmsglenGNF]=GNNDA;}HBHDC{igprintfHHB(HHHs);ijerrorcodeHLF=HM@ijETIMEDOUTHMB;}HNADB(HNK!HNLijerrorcodeHNM){igretvalICM=IDDifunifyIDF(IDKidtcbIDL,IDOidtcbIE@pIECieargsIEE[IEICM],IELiuBNRPLookupTempSymbolIEM(IGAidtcbIGB,IGEijinet_ntoaIGF(IGOijrecv_addrIH@.iisin_addrIHJ)))BLIJBifunifyIJE(IJJidtcbIJK,IJNidtcbIJOpIKBieargsIKD[IKHCM],IKKihmakeintIKL(ILC&ILDidtcbILEpILHichpILJ,ILLijrecv_addrILM.iisin_portIMG));DB(INNiicheckArgINO(IOGidtcbIOHpIOKieargsIOM[J@ACM],J@D&J@EigfilefdJ@F)icEQJ@NieINTTJAA){iffilepJGI=JGO(JHAieFILEJHB*JHG)igfilefdJHI;AG{iferrnoJKB=JKHCN;ifbytesJLM=JMCigfwriteJME(JMKigmsgbufJML,JNBCG(JNJc),JO@igmsglenJOB,JOHiffilepJOJ);}K@NAP(KAF(KAGifbytesKAHicEQKAN-KBACM)BLKBE(KBHiferrnoKBIicEQKBOifEINTRKCB));igfflushKDG(KDMiffilepKDN);igprintfKGC(KGIs,KIDifbytesKIE,KIJigmsglenKIK);DB(KMHifbytesKMIicEQKMO-KNBCM)ijerrorcodeKOB=KOLiferrnoKON;DB(LAD!LAEifbytesLAFBLLALigferrorLAO(LBEiffilepLBF))ijerrorcodeLBN=LCHidEIOLCJ;}LDGDC{ijBNRP_termLFAihsymTermLFK;ijheapcheckMIL(MJEigmsglenMJF+MJLCM);igresultMMF=MMMiimaketermMMO(MNGihLISTTAGMNH,MNOidtcbMOApMODichpMOF);igmsgbufN@L[NABigmsglenNAC]=NAKDA;ihcurrentNCM=NDECN;imcurrentStartNIA=NINCN;AP(OAGihcurrentOAHicLEOB@igmsglenOBC){ilsmallbufferOGO[OHJihcurrentOHK-OICimcurrentStartOIE]=OJCigmsgbufOJE[OJKihcurrentOJL];DB(OLLigmsgbufOLN[OMDihcurrentOME]BMOMNDA){DB(QPTUihcurrentQPTWBNQPT_CNBLQPUTigmsgbufQPUW[QPU]ihcurrentQPU^-QPVUCM]BNQPVYDA){ihsymTermQPW]=QPXUiuBNRPLookupTempSymbolQPXW(QPY[idtcbQPY\,QPY_ilsmallbufferQPZP);iepushQP[V(QP[ZijBNRP_termQP[[,QP\TidtcbQP\VpQP\YichpQP\[,QP\]ihsymTermQP\_);}QP]]imcurrentStartQQQR=QQQ_ihcurrentQQRQ+QQRYCM;}QQSPihcurrentQQSTCEQQS[;}QQVQiepushQQWP(QQWTEA,QQWYidtcbQQWZpQQW]ichpQQW_,QQXQCN);igretvalQQZQ=QQZXigretvalQQZZBLQQ[QifunifyQQ[T(QQ[YidtcbQQ[Z,QQ[]idtcbQQ[_pQQ\RieargsQQ\T[QQ\XCM],QQ\[igresultQQ\]);}QQ]^}QQ^TDB(QQ^^igmsgbufQQ^_){ijBNRP_freeQQ_Y(QRPRigmsgbufQRPS);ijBNRP_freeQRP_(QRQXilsmallbufferQRQY);}QRRWALigretvalQRVUBLQRV\ifunifyQRV_(QRWTidtcbQRWU,QRWXidtcbQRWZpQRW]ieargsQRW_[QRXSCM],QRXVihmakeintQRXX(QRX_&QRYPidtcbQRYQpQRYTichpQRYV,QRYXijerrorcodeQRYZ));}QRZW
BNRP_sendmessageUDP"11568 N {EAihip_term37,3>icip40,42ieport44,48iimsg_term4:,52igsocket54;EIilsockaddr_in64ildestination70;nifbytes91;ipBNRP_sighandler9<iroldSigPipeHandler:?;idTAG<3idtag=6;ieFILE=?*?1iffilep?2;c*A@OigmsgbufAA@;nigmsglenABO;EAijsndbufsizADN;nigoptlenAG@=AGKCG(AHCijsndbufsizAHD);nijerrorcodeAJG=AKBCN;EAijtotalsizeAMN=ANICN;EAiktotalbytesB@E=BA@CN;DB(BB@idtcbBBApBBDihnumargsBBFicNEBBNCM)AL(BCJifFALSEBCK);DB(BDF!BDGisBNRPnetworkUseableBDH)AL(BFBifFALSEBFC);DB(BFOiicheckArgBG@(BGHidtcbBGIpBGLieargsBGN[BHBCM],BHE&BHFigsocketBHG)icNEBHOieINTTBIB)AL(BINifFALSEBIO);DB(BJKiicheckArgBJL(BKDidtcbBKEpBKHieargsBKJ[BKNCM],BLA&BLBihip_termBLC)icNEBLLihSYMBOLTBLO)AL(BMNifFALSEBMO);DB(BNJ(BNKicipBNL=BNOijinet_addrBOA(BOJignameofBOK(C@Aihip_termC@B)))icEQC@MilINADDR_NONECA@)AL(CBCifFALSECBD);DB(CCAiicheckArgCCB(CCJidtcbCCKpCCNieargsCD@[CDDCM],CDG&CDHieportCDI)icNECDOieINTTCEB)AL(CENifFALSECEO);DB(CFJ!CFKiiFD_ISSETCFL(CGDigsocketCGE,CGK&CGLihBNRPfdsCGM))AL(CHOifunifyCI@(CIEidtcbCIF,CIIidtcbCIJpCIMieargsCIO[CJCCM],CJFihmakeintCJG(CJN&CJOidtcbCK@pCKCichpCKE,CKGiiENOTSOCKCKH)));ildestinationCLG.iksin_familyCMC=CMNihAF_INETCN@;ildestinationCNJ.iisin_portCOF=COOifhtonsD@A(D@FieportD@G);igmemcpyD@O(DAE(DAFc*DAL)&DANildestinationDAO.iisin_addrDBK,DCC(DCDc*DCJ)&DCLicipDCM,DCOCG(DDFicipDDG));igprintfDEO(DFEs);DB(DLGikgetsockoptDLH(DMBigsocketDMC,DMIikSOL_SOCKETDMK,DNEijSO_SNDBUFDNG,DO@(DOBihoptValTDOC*DOK)&DOMijsndbufsizDON,E@G(E@IiloptValSizeTE@J*EAF)&EAHigoptlenEAI))ijsndbufsizEBJ=ECDimMAX_MSG_SIZEECF;DB(EDLijsndbufsizEDMicLEEEGCN)ijsndbufsizEIK=EJEimMAX_MSG_SIZEEJG;iroldSigPipeHandlerEKG=ELIiwBNRP_installSighandlerELK(ENAihSIGPIPEENB,ENIitBNRP_initSighandlerENK(EONiosigPipeHandlerEOO));AM(FAMiicheckArgFAN(FBFidtcbFBGpFBJieargsFBL[FC@CM],FCC&FCDiimsg_termFCE)){ACihSYMBOLTFDL:igmsgbufFJ@=FJGignameofFJI(FJOiimsg_termFK@);igmsglenFLC=FLJigstrlenFLL(FMBigmsgbufFMC)+FMKCM;DB(FOMigmsglenFON>G@EijsndbufsizG@G){ijerrorcodeGB@=GBJCM;AB;}GGGAG{iferrnoGKB=GKHCN;ifbytesGLI=GLOigsendtoGMA(GMGigsocketGMH,GMNigmsgbufGN@,GNFigmsglenGNH,GNNCN,GOA(H@NEIiisockaddrHAF*HAO)&HBAildestinationHBB,HBMCG(HCEildestinationHCF));}HDMAP(HEE(HEFifbytesHEGicEQHEM-HF@CM)BLHFD(HFGiferrnoHFHicEQHFNifEINTRHGA));DB(HHFifbytesHHGicEQHHM-HI@CM){igperrorHKB(HKHs);ijerrorcodeHNC=HNMiferrnoHNO;}HONigprintfIAH(IANs,IDIifbytesIDJ,IDOigmsglenIE@);AB;ACieINTTIGI:iffilepIMB=IMH(IMJieFILEIMK*IN@)iimsg_termINB;igmsgbufJBF=JBM(JBOc*JCE)ilBNRP_mallocJCG(JDBijsndbufsizJDC);DB(JHCigmsgbufJHDicEQJHKCN){ijerrorcodeJIO=JJIigENOMEMJJK;AB;}K@HigprintfKAL(KBBs);iiclearerrKEH(KF@iffilepKFA);AP(KNB!KNCiefeofKND(KNHiffilepKNI)BLKO@!KOCigferrorKOD(KOJiffilepKOK)BLL@B!L@EijerrorcodeL@F){iferrnoLAI=LAOCN;igmsglenLBG=LBNiffreadLC@(LCEigmsgbufLCF,LCLCG(LDDc),LDJijsndbufsizLDL,LEEiffilepLEG);DB(LFOigmsglenLG@icGTLGGCN){igprintfLIF(LILs,LLBigmsglenLLD);AG{iferrnoLOM=M@CCN;ifbytesMAL=MBBigsendtoMBD(MBJigsocketMBK,MCAigmsgbufMCC,MCIigmsglenMCK,MDACN,MDD(MFIEIiisockaddrMGA*MGJ)&MGLildestinationMGM,MHHCG(MI@ildestinationMIA));}MK@AP(MKH(MKIifbytesMKJicEQML@-MLCCM)BLMLG(MLJiferrnoMLKicEQMMAifEINTRMMD));DB(MNDifbytesMNEicEQMNK-MNNCM){igperrorNBI(NBOs);ijerrorcodeNFB=NFLiferrnoNFN;AB;}NIDijtotalsizeNJJBDNKEigmsglenNKH;iktotalbytesNLDBDNLOifbytesNMB;}NNC}NNGigprintfNOK(O@As,OAIigferrorOAJ(OB@iffilepOBA),OBGiefeofOBH(OBLiffilepOBM));igprintfOCN(ODDs,OH@iktotalbytesOHA,OHKijtotalsizeOHL);DB(OJD!OJEijerrorcodeOJFBLOK@igferrorOKC(OKIiffilepOKJ))ijerrorcodeOLN=OMHidEIOOMJ;ijBNRP_freeONH(OOAigmsgbufOOB);AB;AE:iwBNRP_installSighandlerQPRP(QPSVihSIGPIPEQPSW,QPS^iroldSigPipeHandlerQPTP);ALifFALSEQPVS;}QPV^iwBNRP_installSighandlerQPWV(QPX\ihSIGPIPEQPX],QPYTiroldSigPipeHandlerQPYV);ALifunifyQP[R(QP[WidtcbQP[X,QP[[idtcbQP[\pQP[_ieargsQP\Q[QP\UCM],QP\XihmakeintQP\Z(QP]Q&QP]RidtcbQP]SpQP]VichpQP]X,QP]ZijerrorcodeQP][));}QP^X
BNRP_receiveUDPbytes"15912 N {c*5?igmsgbuf60=67CN;EAijrcvbufsiz75;nigoptlen89=90CG(98ijrcvbufsiz99);nigmsglen:>;EAigsocket;?;EAigfilefd=0;nifbytes>1;nigretval?1=?;ieTRUE?=;nijerrorcodeA@L=AAFCN;ieFILEAAN*ABCiffilepABD;nifindexACB=ACHCN;EAiglengthADE;EAigresultAEE;idTAGAF@idtagAFE=AFIiicheckArgAFK(AGCidtcbAGDpAGGieargsAGI[AGMCM],AH@&AHBiglengthAHC);EIilsockaddr_inAIKijrecv_addrAJG;ninrecv_addr_lenAKI=ALGCG(ALOijrecv_addrAM@);DB(ANCidtcbANDpANGihnumargsANIicNEAOACM)AL(AOMifFALSEAON);DB(B@K!B@LisBNRPnetworkUseableB@M)AL(BBGifFALSEBBH);DB(BCEiicheckArgBCF(BCNidtcbBCOpBDBieargsBDD[BDHCM],BDK&BDLigsocketBDM)icNEBEEieINTTBEH)AL(BFDifFALSEBFE);DB(BGB!BGCiiFD_ISSETBGD(BGLigsocketBGM,BHC&BHDihBNRPfdsBHE))AL(BIKifunifyBIL(BJAidtcbBJB,BJEidtcbBJFpBJIieargsBJK[BJOCM],BKBihmakeintBKC(BKJ&BKKidtcbBKLpBKOichpBLA,BLCiiENOTSOCKBLD)));DB(BMGigsocketBMHicLTBMOCM)AL(BNKifFALSEBNL);DB(CBKikgetsockoptCBL(CCFigsocketCCG,CCMikSOL_SOCKETCCO,CDIijSO_RCVBUFCDK,CED(CEFihoptValTCEG*CEO)&CFAijrcvbufsizCFB,CFK(CFMiloptValSizeTCFN*CGJ)&CGLigoptlenCGM))ijrcvbufsizCHN=CIHimMAX_MSG_SIZECIJ;DB(CK@ijrcvbufsizCKAicLECKKCN)ijrcvbufsizCOO=D@IimMAX_MSG_SIZED@K;DB(DAO(DB@idtagDBAicEQDBEieINTTDBH)BLDBN(DCAiglengthDCB<DCIijrcvbufsizDCK))ijrcvbufsizDDM=DEGiglengthDEI;igprintfDGC(DGIs);igmsgbufDOE=DOL(DONc*E@D)ilBNRP_mallocE@F(EAAijrcvbufsizEAB);DB(EBDigmsgbufEBEicEQEBLCN){ijBNRP_freeECM(EDFigmsgbufEDG);ALifunifyEEM(EFBidtcbEFC,EFFidtcbEFHpEFKieargsEFM[EGACM],EGDihmakeintEGF(EGM&EGNidtcbEGOpEHBichpEHD,EHFigENOMEMEHH));}EIEDB(EMFimselectSocketEMG(ENCigsocketEND,ENJioBNRPread_timerENK)){igprintfFAG(FAMs);AG{iferrnoFGB=FGHCN;igmsglenFHI=FI@iirecvfromFIB(FIJigsocketFIK,FJAigmsgbufFJC,FJIijrcvbufsizFJK,FKDCN,FKG(FMGEIiisockaddrFMO*FNH)&FNJijrecv_addrFNK,FOD(FOEiloptValSizeTFOF*G@B)&G@Dinrecv_addr_lenG@E);}GAMAP(GBE(GBFigmsglenGBGicEQGBN-GCACM)BLGCE(GCHiferrnoGCIicEQGCOifEINTRGDB));igprintfGFD(GFJs,GHOigmsglenGIA);DB(GJLigmsglenGJMicEQGKD-GKGCM)ijerrorcodeGLG=GMAiferrnoGMC;DCigmsgbufGOC[GOIigmsglenGOJ]=H@BDA;}HCLDC{igprintfHIF(HILs);ijerrorcodeHMJ=HNDijETIMEDOUTHNF;}HOEDB(HOO!I@@ijerrorcodeI@A){ijheapcheckIE@(IEIigmsglenIEJ+IF@CM);igresultIFK=IGBiimaketermIGD(IGLihLISTTAGIGM,IHDidtcbIHFpIHIichpIHK);AP(IIKigmsglenIIL>IJCifindexIJE){iepushIKF(IKJEA,IKOidtcbIL@pILCichpILE,ILGilmakeinttermILH(IMC(IMDENc)igmsgbufINC[INIifindexINJ]));ifindexIOGCEIOL;}J@FiepushJ@N(JABEA,JAGidtcbJAHpJAKichpJAM,JAOCN);}JBMDC{ijBNRP_freeJD@(JDIigmsgbufJDJ);ALifunifyJEM(JFBidtcbJFC,JFFidtcbJFHpJFKieargsJFM[JGACM],JGDihmakeintJGF(JGM&JGNidtcbJGOpJHBichpJHD,JHFijerrorcodeJHH));}JIHigretvalJJC=JJJifunifyJJL(JKAidtcbJKB,JKEidtcbJKFpJKIieargsJKK[JKOCM],JLBiuBNRPLookupTempSymbolJLC(JMGidtcbJMH,JMKijinet_ntoaJML(JNEijrecv_addrJNF.iisin_addrJO@)))BLK@HifunifyK@K(KA@idtcbKAA,KADidtcbKAEpKAHieargsKAJ[KANCM],KBAihmakeintKBB(KBI&KBJidtcbKBKpKBNichpKC@,KCBijrecv_addrKCC.iisin_portKCM))BLKEDifunifyKEG(KELidtcbKEM,KF@idtcbKFBpKFEieargsKFG[KFKCM],KFNigresultKG@);DB(KGOidtagKH@icEQKHDieVARTKHG)igretvalKIC=KIJigretvalKILBLKJCifunifyKJF(KJKidtcbKJL,KJOidtcbKK@pKKCieargsKKE[KKICM],KKLihmakeintKKM(KLD&KLEidtcbKLFpKLIichpKLK,KLMigmsglenKLN));DB(KN@igmsgbufKNA)ijBNRP_freeKNI(KOBigmsgbufKOC);ALigretvalLCIBLLD@ifunifyLDC(LDHidtcbLDI,LDLidtcbLDNpLEAieargsLEC[LEGCM],LEJihmakeintLEL(LFC&LFDidtcbLFEpLFHichpLFJ,LFLijerrorcodeLFN));}LGK
BNRP_sendUDPbytes"19111 N {EAihip_term5=,64icip66,68ieport6:,6>iimsg_term70,78igsocket7:;EIilsockaddr_in8<ildestination98;nifbytes:=;ipBNRP_sighandler;7iroldSigPipeHandler<:;idTAG>0idtag>5;c*?3igbuffer?4;nigmsglenA@D;EAijsndbufsizAAE;nigoptlenABH=ACCCG(ACKijsndbufsizACL);nijerrorcodeAE@=AEKCN;EAihmessageAFI,AG@ibpAGB,AGCiglengthAGE,AGKieorigAGM,AHAigresultAHC;idptrAHNieaddrAIC;nifindexAJ@=AJFCN;EAijtotalsizeALD=ALOCN;EAiktotalbytesAMM=ANHCN;DB(AOJidtcbAOKpAONihnumargsB@@icNEB@HCM)AL(BADifFALSEBAE);DB(BBB!BBCisBNRPnetworkUseableBBD)AL(BCNifFALSEBCO);DB(BDMiicheckArgBDN(BEFidtcbBEGpBEJieargsBEL[BF@CM],BFC&BFDigsocketBFE)icNEBFMieINTTBG@)AL(BGLifFALSEBGM);DB(BHKiicheckArgBHL(BIDidtcbBIEpBIHieargsBIJ[BINCM],BJA&BJBihip_termBJC)icNEBJLihSYMBOLTBJO)AL(BKNifFALSEBKO);DB(BLL(BLMicipBLN=BMAijinet_addrBMC(BMLignameofBMM(BNCihip_termBND)))icEQBNOilINADDR_NONEBOB)AL(C@EifFALSEC@F);DB(CAEiicheckArgCAF(CANidtcbCAOpCBBieargsCBD[CBHCM],CBK&CBLieportCBM)icNECCCieINTTCCF)AL(CDBifFALSECDC);DB(CE@!CEAiiFD_ISSETCEB(CEJigsocketCEK,CFA&CFBihBNRPfdsCFC))AL(CGIifunifyCGJ(CGOidtcbCH@,CHCidtcbCHDpCHGieargsCHI[CHMCM],CI@ihmakeintCIA(CIH&CIIidtcbCIJpCIMichpCIO,CJAiiENOTSOCKCJB)));ildestinationCKC.iksin_familyCKO=CLJihAF_INETCLL;ildestinationCMH.iisin_portCND=CNMifhtonsCNO(CODieportCOE);igmemcpyCOO(D@E(D@Fc*D@L)&D@NildestinationD@O.iisin_addrDAK,DBC(DBDc*DBJ)&DBLicipDBM,DBOCG(DCFicipDCG));igprintfDEA(DEGs);iroldSigPipeHandlerDIA=DJCiwBNRP_installSighandlerDJE(DKKihSIGPIPEDKL,DLCitBNRP_initSighandlerDLE(DMHiosigPipeHandlerDMI));DB(E@HiicheckArgE@I(EAAidtcbEABpEAEieargsEAG[EAKCM],EAN&EAOihmessageEB@)icNEEBIifLISTTEBL)AL(ECOifFALSEED@);DB(EG@iicheckArgEGA(EGIidtcbEGJpEGMieargsEGO[EHCCM],EHF&EHGiglengthEHH)icNEEI@ieINTTEIC)AL(EJEifFALSEEJF);DB(EOFikgetsockoptEOG(F@AigsocketF@B,F@HikSOL_SOCKETF@J,FADijSO_SNDBUFFAF,FAO(FBAihoptValTFBB*FBJ)&FBLijsndbufsizFBM,FCF(FCHiloptValSizeTFCI*FDE)&FDGigoptlenFDH))ijsndbufsizFEG=FFAimMAX_MSG_SIZEFFC;DB(FGHijsndbufsizFGIicLEFHCCN)ijsndbufsizFLE=FLOimMAX_MSG_SIZEFMA;DB(FNEijsndbufsizFNFicLTFO@iglengthFOC){ijsndbufsizG@F=GA@iglengthGAB;iksetsockoptGB@(GBJigsocketGBK,GCAikSOL_SOCKETGCC,GCMijSO_SNDBUFGCO,GDH(GDJihoptValTGDK*GEB)&GEDijsndbufsizGEE,GEN(GF@iloptValSizeTGFA)igoptlenGFN);}GGJigbufferGIK=GJB(GJDc*GJJ)ilBNRP_mallocGJL(GKGijsndbufsizGKH);DB(GLJigbufferGLKicEQGMBCN){ijBNRP_freeGNC(GNLigbufferGNM);ALifunifyH@C(H@HidtcbH@I,H@LidtcbH@NpHAAieargsHAC[HAGCM],HAJihmakeintHAL(HBC&HBDidtcbHBEpHBHichpHBJ,HBLigENOMEMHBN));}HCKibpHFN=HG@igaddrofHGB(HGHihmessageHGI);ihderefTVHHF(HHM&HHNibpHHO,HI@&HIBieorigHIC,HIG&HIIidtagHIJ,HIM&HIOigresultHJ@,HJF&HJHieaddrHJI);AP(HKH(HKIidtagHKJicNEHKNieENDTHLA)BLHLG(HLJifindexHLK<HMAijsndbufsizHMC)){DB(IAMidtagIANicNEIBBieINTTIBE){ijBNRP_freeICE(ICNigbufferICO);AL(IE@ifFALSEIEA);}IEODB(III(IIJigresultIIKicLTIJBCN)BKIJH(IJKigresultIJLicGTIKCCM)){ijBNRP_freeILF(ILOigbufferIM@);AL(INAifFALSEINB);}IO@igbufferIOO[J@EifindexJ@F]=J@M(J@Oc)igresultJAF;ihderefTVJBE(JBL&JBMibpJBN,JBO&JC@ieorigJCA,JCE&JCFidtagJCG,JCJ&JCKigresultJCL,JDB&JDCieaddrJDD);ifindexJEACEJEF;}JEMiferrnoJFI=JG@CN;AG{ifbytesJHD=JHJigsendtoJHL(JIBigsocketJIC,JIIigbufferJIK,JJAiglengthJJC,JJICN,JJL(JLIEIiisockaddrJMA*JMJ)&JMLildestinationJMM,JNHCG(JO@ildestinationJOA));}K@CAP(K@K(K@LifbytesK@MicEQKAC-KAFCM)BLKAJ(KAMiferrnoKANicEQKBDifEINTRKBG));DB(KCNifbytesKCOicEQKDE-KDHCM){igperrorKHN(KIDs);ijerrorcodeKKG=KLAiferrnoKLC;}KLMigprintfKNB(KNHs,LBCifbytesLBK,LC@ikbuffersizeLCB);iwBNRP_installSighandlerLDN(LFDihSIGPIPELFE,LFLiroldSigPipeHandlerLFN);ijBNRP_freeLHE(LHNigbufferLHO);ALifunifyLJB(LJGidtcbLJH,LJKidtcbLJLpLJOieargsLKA[LKECM],LKHihmakeintLKI(LL@&LLAidtcbLLBpLLEichpLLG,LLIijerrorcodeLLK));}LMH